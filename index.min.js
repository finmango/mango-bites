const fs=require("fs"),readline=require("readline"),{google:google}=require("googleapis"),SCOPES=["https://www.googleapis.com/auth/spreadsheets.readonly"],TOKEN_PATH="token.json";function authorize(e,o){const{client_secret:t,client_id:r,redirect_uris:s}=e.installed,n=new google.auth.OAuth2(r,t,s[0]);fs.readFile(TOKEN_PATH,((e,t)=>{if(e)return getNewToken(n,o);n.setCredentials(JSON.parse(t)),o(n)}))}function getNewToken(e,o){const t=e.generateAuthUrl({access_type:"offline",scope:SCOPES});console.log("Authorize this app by visiting this url:",t);const r=readline.createInterface({input:process.stdin,output:process.stdout});r.question("Enter the code from that page here: ",(t=>{r.close(),e.getToken(t,((t,r)=>{if(t)return console.error("Error while trying to retrieve access token",t);e.setCredentials(r),fs.writeFile(TOKEN_PATH,JSON.stringify(r),(e=>{if(e)return console.error(e);console.log("Token stored to",TOKEN_PATH)})),o(e)}))}))}function listMajors(e){google.sheets({version:"v4",auth:e}).spreadsheets.values.get({spreadsheetId:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms",range:"Class Data!A2:E"},((e,o)=>{if(e)return console.log("The API returned an error: "+e);const t=o.data.values;t.length?(console.log("Name, Major:"),t.map((e=>{console.log(`${e[0]}, ${e[4]}`)}))):console.log("No data found.")}))}fs.readFile("credentials.json",((e,o)=>{if(e)return console.log("Error loading client secret file:",e);authorize(JSON.parse(o),listMajors)}));